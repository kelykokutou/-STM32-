# -STM32-
基于STM32单片机的智能家居控制系统的设计和实现工作。实现利用光电传感器采集环境光照强度，使灯光自动调节功能、窗帘自动开合，提升自动化水平，优化能源使用效率。
在本次设计之前，我已经有过相关的设计经验，我也尽可能将设计的每一处都做到完
美。尽管如此，本次设计中仍有几处缺陷。

1、电路板正面的铺铜没有与强电拉开距离

    用于控制电灯的继电器在设计时考虑到了将其真实连接到220V 工频交流电的情形，因此在电路板背面，继电器附近没有进行铺铜，以防止外接高电压与铺铜过近，导致击穿。
但是在板子的正面并没有这样的处理，而继电器又是通孔焊接，导致实际工作时，高电压会通过通孔来到正面，有可能在正面的铺铜处产生击穿

2、续流二极管连接错误

    续流二极管是反向连接在电机与电源和地线间的二极管，用于释放电机突然断电时产生的高压反电动势，保护驱动电路。那么，续流二极管应当连接在电机的供电电源和电机之间。
但是，由于我一开始设计时，并没有考虑到外接电机供电电源的情况，是直接使用板载5V 电源驱动电机。所以续流二极管是连接在5V 电源 和电机之间的。后期加上外部供电电路后，却没有修正这个设计，导致电机与电机电源间的续流二极管只有在使用板载5V 供电时才有作用，使用外接电源时无法生效。

3、程序内部耦合不合理，程序归属不清晰

    我本人编写代码一般是从下至上编写，在主源文件在确定各模块正常运作后；将程序分类至各模块对应的源文件，再依托现有程序，再从上至下重新构建一遍。但本次程序编写的时间不是很充足，导致程序的分类不彻底，并且产生了奇怪的耦合。比如光照值的获取程序，由于是先进行第一页UI 的显示代码的编写，因此该程序就被放在了第一页的UI 显示代码中，也就是说，只要去到其他页面，那么光照值就不会更新，光照更新标志位也无法清除。虽然在本项目中不是什么问题，但是后期如果想进行功能扩展，那么势必会浪费多余的时间，还会由此产生其他的bug。
另外程序的分类也不彻底。各模块的功能函数并没有放到各自对应的源文件中，尤其是UI 相关代码，全部都在主源文件中，通过全局变量交换数据。并没有封装到各自对应的源文件中，通过参数交换数据。这不仅使得main 函数看起来又臭又长，也不利于后续其他开发时的代码复用。也间接导致了UI 相关代码不够模块化。

对于以上问题，我的思考是：

缺陷1 是由于设计经验不足导致的。

我考虑到了强电导致击穿的问题，但由于经验不足，考虑得不够全面，导致我只想到了在背面的区域避开铺铜，却没有想到正面也要做同样的处理。但此次错误之后，我想必会在以后的设计中注意此类问题。

缺陷2 是由于规划不完善和检查措施不到位导致的。

在一开始设计的时候，我并没有考虑到外接电源以驱动更大功率电机的问题。而在添加外接电源电路之后，我没有完善的检查措施发现连接错误的问题。在以后的设计中，不仅在前期要做好规划，充分考虑设计的工况，也要完善检查机制，对于修改所涉及到的每一个网络连接，都要做好检查，判断是否要进行相应的修改。

缺陷3 是由于时间不太充足和编程习惯导致的。

我的这次的编程时间并不是很充裕，虽然我平时的时间规划做的并不好，但这次我认为时间规划并不是主要原因，因为本次设计过程中碰到了一些不可控因素（比如花费了我将近一天的时间解决的关于BH1750 在使用ST 官方HAL 库中出现的IIC 无应答问题），导致耽误了不少时间。另外我的编程习惯也导致了我想要编写出一份模块间解耦且函数分类明确的代码需要较长的时间，毕竟这包含了一个将现有程序架构打碎后重组的过程。
在以后的设计中，我会尽力做到合理的时间规划，同时尝试使用其他的编程方式，缩减构建代码的时间。

大学时光如我所想一样匆匆地就要过去了，这份设计与报告，可能是我在这所学校里的最后一份作业。
在这里，我要感谢我的老师们。
是老师教会了我知识，让我有了前进的基石；是老师带领着我进入了项目班，让我有了学习和实验的平台，让我提前认识了负责各类比赛的老师们；是老师告诉了我未曾听闻的各项比赛，让我有了进一步学习与进步的机会，让我看到了其他的道路；是老师将我推向我未曾涉足的领域，这让我迷茫与困惑，却也推动我前进，让我学习到了我想要了解却没去学习，和我或许一生也不会涉及的知识，我因此而进步，也此而快乐。
没有我的老师们，就没有这份设计和报告，更没有现在的我。
再次，向所有教导我，指导我，推动我前进的老师们致谢。
